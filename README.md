# ä¸€. ğŸ¦ ç ”ç©¶èƒŒæ™¯åŠæ„ä¹‰
 æ—…æ¸¸ä½œä¸ºä¸€ç§ç»æµæ´»åŠ¨ï¼Œå·²ç»æˆä¸ºä¸–ç•Œç»æµä¸­ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚æ—…æ¸¸ä¸šçš„å¿«é€Ÿå‘å±•ï¼Œä½¿å¾—æ—…æ¸¸äº§å“å’ŒæœåŠ¡çš„ä¾›åº”å’Œéœ€æ±‚æ—¥ç›Šå¢åŠ ï¼Œå…¶ä¸­æ—…æ¸¸ç½‘ç«™èµ·ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚è¿‘å¹´æ¥ï¼Œéšç€ç§»åŠ¨äº’è”ç½‘çš„æ™®åŠå’ŒæŠ€æœ¯çš„è¿›æ­¥ï¼Œæ—…æ¸¸ç½‘ç«™ä¸æ–­åˆ›æ–°å’Œå‘å±•ï¼Œä¸ºæ—…æ¸¸å¸‚åœºçš„å‘å±•è´¡çŒ®äº†å·¨å¤§çš„åŠ›é‡ã€‚

æ—…æ¸¸ç½‘ç«™çš„ç ”ç©¶èƒŒæ™¯åœ¨äºï¼Œé€šè¿‡å¯¹æ—…æ¸¸ç½‘ç«™çš„å¸‚åœºç°çŠ¶ã€ç”¨æˆ·éœ€æ±‚å’ŒæŠ€æœ¯åˆ›æ–°ç­‰æ–¹é¢è¿›è¡Œç ”ç©¶ï¼Œä»¥æ›´å¥½åœ°äº†è§£æ—…æ¸¸ç½‘ç«™çš„å‘å±•è¶‹åŠ¿å’Œç”¨æˆ·ç‰¹å¾ï¼Œè¿›è€Œä¸ºæ—…æ¸¸ç½‘ç«™çš„è®¾è®¡å’Œä¼˜åŒ–æä¾›ä¾æ®ï¼Œæå‡æ—…æ¸¸ç½‘ç«™çš„æœåŠ¡è´¨é‡å’Œç”¨æˆ·ä½“éªŒã€‚

æ—…æ¸¸ç½‘ç«™çš„ç ”ç©¶æ„ä¹‰åœ¨äºï¼Œä¸ºæ—…æ¸¸ç½‘ç«™çš„è®¾è®¡å’Œä¼˜åŒ–æä¾›äº†æ€è·¯å’Œæ–¹æ³•ï¼Œä»¥æ»¡è¶³ç”¨æˆ·å¤šæ ·åŒ–çš„éœ€æ±‚ã€‚åŒæ—¶ï¼Œå¯ä»¥å¸®åŠ©ä¼ä¸šæ›´å¥½åœ°æŠŠæ¡å¸‚åœºçš„æœºé‡å’ŒæŒ‘æˆ˜ï¼Œæå‡æ—…æ¸¸äº§å“å’ŒæœåŠ¡çš„è´¨é‡å’Œæ•ˆç›Šã€‚æ­¤å¤–ï¼Œéšç€æ—…æ¸¸ä¸šçš„ä¸æ–­å‘å±•ï¼Œæ—…æ¸¸ç½‘ç«™çš„ç ”ç©¶ä¹Ÿä¸ºæ—…æ¸¸ä¸šçš„å‡çº§å’Œè½¬å‹æä¾›äº†æœ‰ä»·å€¼çš„å‚è€ƒå’Œå€Ÿé‰´ã€‚ç»¼ä¸Šæ‰€è¿°ï¼Œæ—…æ¸¸ç½‘ç«™çš„ç ”ç©¶å…·æœ‰ååˆ†é‡è¦å’Œç°å®çš„æ„ä¹‰ã€‚
# äºŒ. ğŸ¦ æŠ€æœ¯æ ˆç³»åˆ—åŠä¸»è¦åŠŸèƒ½
## â… . æŠ€æœ¯æ ˆ
- **Springboot**
- **SpringMVC**
- **MySQL**
- **Mybatis-Plus**
- **SpringSecurity**
- **Thymeleaf**
- **AdminLTE2**
- **lombokã€ajaxã€logback**
## â…¡. ä¸»è¦åŠŸèƒ½
æœ¬ç³»ç»ŸåŸºäºä»¥ä¸ŠæŠ€æœ¯æ¥å®ç°ä¸€ä¸ªå®Œå–„çš„æ—…æ¸¸ç½‘åå°ç®¡ç†ç³»ç»Ÿï¼Œå…·æœ‰ä»¥ä¸‹ä¸»è¦åŠŸèƒ½ï¼š
- ç®¡ç†å‘˜ç®¡ç†
- è§’è‰²ç®¡ç†
- æƒé™ç®¡ç†
- è®¤è¯å’Œæˆæƒ
- äº§å“ç±»å‹ç®¡ç†
- æ—…æ¸¸äº§å“ç®¡ç†
# ä¸‰. ğŸ¦ é¡¹ç›®æ­å»º
## â… . åç«¯æ¨¡å—
è¯¥é¡¹ç›®å’Œå¹³å¸¸é¡¹ç›®å·®ä¸å¤šï¼Œåç«¯æ¨¡å—æŒ‰å¹³å¸¸Springbooté¡¹ç›®ç»“æ„æ­å»ºå³å¯ï¼Œå¦‚ä¸‹ï¼š

![è¾“å…¥å›¾ç‰‡è¯´æ˜](imges/1.png)

## â…¡. å‰ç«¯æ¨¡å—
åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨AdminLTEæ¡†æ¶ä½œä¸ºç®¡ç†å‘˜ç«¯é¡µé¢ï¼Œä½¿ç”¨è‡ªå·±ç¼–å†™çš„ç½‘é¡µä½œä¸ºç”¨æˆ·ç«¯é¡µé¢ã€‚
>tips:
>AdminLTEæ˜¯ä¸€æ¬¾å»ºç«‹åœ¨bootstrapå’Œjqueryä¹‹ä¸Šçš„å¼€æºçš„æ¨¡æ¿ä¸»é¢˜å·¥å…·ï¼Œå®ƒæä¾›äº†ä¸€ç³»åˆ—å“åº”çš„ã€ å¯é‡å¤ä½¿ç”¨çš„ç»„ä»¶ï¼Œå¹¶å†…ç½®äº†å¤šä¸ªæ¨¡æ¿é¡µé¢ï¼›åŒæ—¶è‡ªé€‚åº”å¤šç§å±å¹•åˆ†è¾¨ç‡ï¼Œå…¼å®¹PCå’Œç§»åŠ¨ç«¯ã€‚é€šè¿‡AdminLTEï¼Œæˆ‘ä»¬å¯ä»¥å¿«é€Ÿçš„åˆ›å»ºä¸€ä¸ªå“åº”å¼çš„Html5ç½‘ç«™ã€‚AdminLTEæ¡†æ¶åœ¨ç½‘é¡µæ¶æ„ä¸è®¾è®¡ä¸Šï¼Œæœ‰å¾ˆå¤§çš„è¾…åŠ©ä½œç”¨ï¼Œå°¤å…¶æ˜¯å‰ç«¯æ¶æ„è®¾è®¡å¸ˆï¼Œç”¨å¥½AdminLTE ä¸ä½†ç¾è§‚ï¼Œè€Œä¸”å¯ä»¥å…å»å†™å¾ˆå¤§CSSä¸JSçš„å·¥ä½œé‡ã€‚

ä½¿ç”¨AdminLTEéå¸¸ç®€å•ï¼Œåªéœ€è¦æ ¹æ®éœ€æ±‚å°†éœ€è¦çš„ç»„ä»¶å¤åˆ¶åˆ°æˆ‘ä»¬çš„é¡µé¢ä¸­å³å¯ã€‚

![è¾“å…¥å›¾ç‰‡è¯´æ˜](imges/image.png)

# å››. ğŸ¦ ä¸»è¦å®ç°è¿‡ç¨‹
ä¸»è¦æŒ‘å‡ ä¸ªæ ¸å¿ƒéƒ¨åˆ†æ¥å±•å¼€æè¿°ï¼š
## â… . è®¤è¯å’Œæˆæƒ
### 1. SpringSecurityé…ç½®ç±»
ä¼—æ‰€å‘¨çŸ¥ï¼ŒSpringSecurityéµå¾ª**RBACåŸåˆ™**ï¼Œå³è§’è‰²ï¼Œæƒé™ï¼Œç”¨æˆ·è¡¨ï¼Œåœ¨æˆ‘ä»¬æ·»åŠ å®Œè¿™ä¸ªè¡¨çš„å®ä½“ç±»ä»¥åŠä¸€äº›å¸¸è§„CRUDæ“ä½œåï¼Œå°±å¯ä»¥å¼€å§‹ç¼–å†™ç³»ç»Ÿçš„è®¤è¯å’Œæˆæƒäº†ã€‚
å¦‚ä½•æ¥ç¼–å†™ä¸€ä¸ªæƒé™è¡¨ï¼Ÿè¯¦æƒ…è¯·çœ‹ç‹®å­å‰é¢çš„æ–‡ç« ï¼š[ç‚¹å‡»](https://blog.csdn.net/m0_58847451/article/details/130062083?spm=1001.2014.3001.5501)
```java
import com.lion.security.handler.MyAccessDeniedHandler;
import com.lion.security.handler.MyLoginFailureHandler;
import com.lion.security.handler.MyLoginSuccessHandler;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;

@Configuration
@EnableGlobalMethodSecurity(prePostEnabled = true)     // å¼€å¯æ³¨è§£-é‰´æƒé…ç½®
public class SecurityConfig extends WebSecurityConfigurerAdapter {

    // Spring Securityé…ç½®
    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.formLogin()
                .loginPage("/backstage/admin_login")         //è‡ªå®šä¹‰è¡¨å•ç™»å½•
                .usernameParameter("username")          //ç”¨æˆ·å
                .passwordParameter("password")          //å¯†ç 
                .loginProcessingUrl("/backstage/admin/login")   //ç™»å½•æäº¤è·¯å¾„ï¼Œæäº¤åæ‰§è¡Œè®¤è¯é€»è¾‘
                .successHandler(new MyLoginSuccessHandler())    //ç™»å½•æˆåŠŸè·³è½¬è·¯å¾„
                .failureHandler(new MyLoginFailureHandler());    //ç™»å½•å¤±è´¥è·³è½¬è·¯å¾„
//          æƒé™æ‹¦æˆªé…ç½®
        http.authorizeRequests()
                .antMatchers("/backstage/admin/login").permitAll()      //ç™»å½•ä¸éœ€è¦è®¤è¯
                .antMatchers("/backstage/admin_fail").permitAll()       //ç™»å½•å¤±è´¥ä¸éœ€è¦è®¤è¯
                .antMatchers("/backstage/admin_login").permitAll()      //ç™»å½•é¡µä¸éœ€è¦è®¤è¯
                .antMatchers("/**/*.css","/**/*.js").permitAll()        //é™æ€èµ„æºæ”¾è¡Œ
                .antMatchers("/backstage/**").authenticated();          //å‰©ä¸‹çš„éƒ½è¦è®¤è¯

//        é€€å‡ºç™»å½•é…ç½®
        http.logout()
                .logoutUrl("/backstage/admin/logout")       //é€€å‡ºç™»å½•çš„è·¯å¾„
                .logoutSuccessUrl("/backstage/admin_login") //é€€å‡ºç™»å½•æˆåŠŸåè·³è½¬çš„é¡µé¢
                .clearAuthentication(true)                  //é€€å‡ºæˆåŠŸåæ¸…é™¤è®¤è¯ä¿¡æ¯
                .invalidateHttpSession(true);                //é€€å‡ºæˆåŠŸåæ¸…é™¤session
//            å¼‚å¸¸å¤„ç†
        http.exceptionHandling()
                .accessDeniedHandler(new MyAccessDeniedHandler());  //æƒé™ä¸è¶³å¤„ç†å™¨

//        å…³é—­csrfé˜²æŠ¤
        http.csrf().disable();
//        å¼€å¯è·¨åŸŸè®¿é—®
        http.cors();

    }
//    å¯†ç åŠ å¯†å™¨
    @Bean
    public BCryptPasswordEncoder bCryptPasswordEncoder(){
        return new BCryptPasswordEncoder();
    }
}

```
securityçš„é…ç½®ç±»å†™æ³•å¾ˆç±»ä¼¼ï¼Œå’±ä»¬åˆ†å—æ¥å®ç°ï¼š

**è‡ªå®šä¹‰è¡¨å•ç™»å½•å—**â€”â€”>**æƒé™æ‹¦æˆªé…ç½®**â€”â€”>**é€€å‡ºç™»å½•é…ç½®**â€”â€”>**å¼‚å¸¸å¤„ç†**â€”â€”>**å…³é—­csrfé˜²æŠ¤**â€”â€”> **å¼€å¯è·¨åŸŸè®¿é—®**â€”â€”>**å¯†ç åŠ å¯†å™¨**
æ ¹æ®è‡ªå·±éœ€è¦æ¥ç¼–å†™ç›¸åº”æ¨¡å—ï¼Œè¯¦ç»†ç›®å½•å¦‚ä¸‹ï¼š

![è¾“å…¥å›¾ç‰‡è¯´æ˜](imges/14image.png)

### 2. è‡ªå®šä¹‰é€»è¾‘è®¤è¯

```java
import com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;
import com.lion.domain.Admin;
import com.lion.domain.Permission;
import com.lion.mapper.AdminMapper;
import com.lion.service.AdminService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.User;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;

@Service
public class MyUserDetailService implements UserDetailsService {
    @Autowired
    private AdminService adminService;


    // è‡ªå®šä¹‰è®¤è¯é€»è¾‘
    @Override
    public UserDetails loadUserByUsername(String username) throws UsernameNotFoundException {
        // 1.è®¤è¯
        Admin admin = adminService.findByAdminName(username);
        if (admin == null) {
            throw new UsernameNotFoundException("ç”¨æˆ·ä¸å­˜åœ¨");
        }
//        adminçš„çŠ¶æ€æ˜¯ä¸å¯ç™»å½•åˆ™æŠ¥é”™ï¼ˆè‡ªå®šä¹‰ï¼‰
        if (!admin.isStatus()){
            throw new UsernameNotFoundException("ç”¨æˆ·ä¸å¯ç”¨");
        }


        // 2.æˆæƒ
        List<Permission> permissions = adminService.findAllPermission(username);
        List<GrantedAuthority> grantedAuthorities = new ArrayList<>();
        for (Permission permission : permissions) {
            grantedAuthorities.add(new SimpleGrantedAuthority(permission.getPermissionDesc()));
        }


        // 3.å°è£…ä¸ºUserDetailså¯¹è±¡
        UserDetails userDetails = User.withUsername(admin.getUsername())
                .password(admin.getPassword())
                .authorities(grantedAuthorities)
                .build();


        // 4.è¿”å›å°è£…å¥½çš„UserDetailså¯¹è±¡
        return userDetails;
    }
}
```
## â…¡. å¯Œæ–‡æœ¬ç¼–è¾‘å™¨â€”â€”wangEditor
åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸­å›½äººå¼€å‘çš„ä¸€ä¸ªå¯Œæ–‡æœ¬ç¼–è¾‘å™¨â€”â€”wangEditorï¼Œå®˜ç½‘åœ°
å€ï¼š[https://www.wangeditor.com/](https://www.wangeditor.com/)
ä½¿ç”¨æ­¥éª¤å¦‚ä¸‹ï¼š
1. åœ¨å‰ç«¯é¡µé¢ä¸­å¼•å…¥ wangEditor.js
2. åœ¨é¡µé¢ä¸­åŠ å…¥ wangEditor æ’ä»¶
3. ç¼–å†™å®ä½“ç±»è¿”å›å€¼
>wangEditorè¦æ±‚ä¸Šä¼ å›¾ç‰‡çš„è¿”å›å€¼å¿…é¡»æŒ‰ç…§å®ƒçš„è¦æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®ä½“ç±»ï¼Œç”¨äºè¿”å›ä¸Šä¼ çš„ç»“æœã€‚

```java
import lombok.Data;

@Data
public class WangEditorResult {
    private int errno;
    private String[] data;
}

```

4. ç¼–å†™ä¸Šä¼ æ§åˆ¶å™¨ï¼Œæ¥æ”¶å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ä¸Šä¼ çš„å›¾ç‰‡

```java
@RequestMapping(value = "/upload")
    @ResponseBody
    public WangEditorResult upload(HttpServletRequest request, MultipartFile file) throws Exception {
        // åˆ›å»ºæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾ä¸Šä¼ æ–‡ä»¶ã€‚
        //1.è®¾ç½®ä¸Šä¼ æ–‡ä»¶å¤¹çš„çœŸå®è·¯å¾„
        String realPath = ResourceUtils.getURL("classpath:").getPath()+"/static/upload/";;
        //2.åˆ¤æ–­è¯¥æ–‡ä»¶å¤¹æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œæ–°å»ºæ–‡ä»¶å¤¹
        File dir = new File(realPath);
        if (!dir.exists()){
            dir.mkdirs();
        }
        // æ‹¿åˆ°ä¸Šä¼ æ–‡ä»¶å
        String filename = file.getOriginalFilename();
        filename = UUID.randomUUID()+filename;
        // åˆ›å»ºç©ºæ–‡ä»¶
        File newFile = new File(dir, filename);
        // å°†ä¸Šä¼ çš„æ–‡ä»¶å†™åˆ°ç©ºæ–‡ä»¶ä¸­
        file.transferTo(newFile);


        WangEditorResult wangEditorResult = new WangEditorResult();
        String[] data = {"/upload/"+filename};
        wangEditorResult.setErrno(0);
        wangEditorResult.setData(data);
        return wangEditorResult;
    }
```
5. åœ¨ymlä¸­é…ç½®ä¸Šä¼ æ–‡ä»¶çš„å¤§å°

```xml
# ä¸Šä¼ æ–‡ä»¶
  servlet:
    multipart:
      max-file-size: 10MB # æœ€å¤§å•ä¸ªæ–‡ä»¶
      max-request-size: 10MB # ä¸€æ¬¡è¯·æ±‚æœ€å¤§ä¸Šä¼ 
```
è¿™æ ·ï¼Œä¸€ä¸ªç¼–è¾‘å™¨å°±å®Œæˆäº†ï¼ï¼ï¼
![è¾“å…¥å›¾ç‰‡è¯´æ˜](imges/11image.png)


## â…¢. ç¼–å†™AOPå®ç°æ—¥å¿—è®°å½•åŠŸèƒ½
### 1. ç¼–å†™logback.xmlæ–‡ä»¶
åœ¨åå°ä»£ç è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¦å¯¹æ¯ä¸€æ¬¡æ“ä½œè¿›è¡Œæ—¥å¿—è®°å½•ï¼Œä¸€æ–¹é¢é€šè¿‡æ—¥å¿—å¯ä»¥å‘ç°ä»£ç çš„ç¼ºé™·ï¼Œå¦ä¸€æ–¹é¢å¯ä»¥è¿½è¸ªå†…éƒ¨äººå‘˜çš„æ“ä½œè®°å½•ã€‚
**SpringBooté»˜è®¤ä½¿ç”¨Logbackç»„ä»¶ä½œä¸ºæ—¥å¿—ç®¡ç†ï¼Œé¦–å…ˆåœ¨ /resources ä¸‹æ·»åŠ Logbacké…ç½®æ–‡ä»¶ logback.xml**
```xml
åœ¨è¿™é‡Œæ’å…¥ä»£ç ç‰‡<?xml version="1.0" encoding="UTF-8" ?>
<configuration>
    <!--å®šä¹‰æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨åœ°å€-->
    <property name="LOG_HOME" value="${catalina.base}/logs/"/>


    <!-- æ§åˆ¶å°è¾“å‡º -->
    <appender name="Stdout" class="ch.qos.logback.core.ConsoleAppender">
        <!-- æ—¥å¿—è¾“å‡ºç¼–ç  -->
        <layout class="ch.qos.logback.classic.PatternLayout">
            <!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦%msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦-->
            <pattern>%d{MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n
            </pattern>
        </layout>
    </appender>


    <!-- æŒ‰ç…§æ¯å¤©ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ -->
    <appender name="RollingFile" class="ch.qos.logback.core.rolling.RollingFileAppender">
        <rollingPolicy class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy">
            <!--æ—¥å¿—æ–‡ä»¶è¾“å‡ºçš„æ–‡ä»¶å-->
            <FileNamePattern>${LOG_HOME}/server.%d{yy99-MM-dd}.log</FileNamePattern>
            <MaxHistory>30</MaxHistory>
        </rollingPolicy>
        <layout class="ch.qos.logback.classic.PatternLayout">
            <!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¶é—´ï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦%msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦-->
            <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n
            </pattern>
        </layout>
        <!--æ—¥å¿—æ–‡ä»¶æœ€å¤§çš„å¤§å°-->
        <triggeringPolicy class="ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy">
            <MaxFileSize>10MB</MaxFileSize>
        </triggeringPolicy>
    </appender>


    <!-- æ—¥å¿—è¾“å‡ºçº§åˆ« -->
    <root level="info">
        <appender-ref ref="Stdout"/>
        <appender-ref ref="RollingFile"/>
    </root>
</configuration>
```
å†™æ³•å¾ˆå›ºå®šï¼Œç†è§£å³å¯ï¼ï¼ï¼

### 2. ç¼–å†™æ—¥å¿—è®°å½•å®ä½“ç±»

```java
import lombok.Data;
import java.util.Date;

@Data
public class Log {
    private String url; // è®¿é—®çš„è·¯å¾„
    private Date visitTime; // è®¿é—®æ—¶é—´
    private String username; // è®¿é—®è€…
    private String ip; // è®¿é—®ip
    private int executionTime; // è®¿é—®æ—¶é•¿
    private String exceptionMessage; // å¼‚å¸¸ä¿¡æ¯
}

```
### 3. ç¼–å†™æ—¥å¿—AOPç±»

```bash
import com.lion.bean.Log;
import org.aspectj.lang.JoinPoint;
import org.aspectj.lang.annotation.*;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.User;
import org.springframework.stereotype.Component;

import javax.servlet.http.HttpServletRequest;
import java.util.Date;

@Component
@Aspect
public class LogAop {
    @Autowired
    private HttpServletRequest request;
    @Autowired
    private final static Logger logger = LoggerFactory.getLogger(LogAop.class);


    /**
     * åˆ‡ç‚¹ï¼Œä»¥backstageçš„æ‰€æœ‰controlleræ–¹æ³•ä½œä¸ºåˆ‡ç‚¹
     */
    @Pointcut("execution(* com.lion.controller.backstage.*.*(..))")
    public void pointCut(){}

    /**
     * å‰ç½®é€šçŸ¥
     * @param joinPoint
     */
    @Before("pointCut()")
    public void doBefore(JoinPoint joinPoint) {
        // è®°å½•è®¿é—®æ—¶é—´
        Date date = new Date();
        request.setAttribute("visitTime",date);
    }

    /**
     * åç½®é€šçŸ¥
     */
    @After("pointCut()")
    public void doAfter(){
        Log log = new Log();

        Date visitTime = (Date) request.getAttribute("visitTime"); // è®¿é—®æ—¶é—´
        Date now = new Date();
        int executionTime = (int)(now.getTime() - visitTime.getTime()); // è®¿é—®æ—¶é•¿
        String ip = request.getRemoteAddr(); // è®¿é—®ip
        String url = request.getRequestURI();// è®¿é—®è·¯å¾„
        // æ‹¿åˆ°securityä¸­çš„Userå¯¹è±¡
        Object user = SecurityContextHolder.getContext().getAuthentication().getPrincipal();
        if (user instanceof User){
            String username = ((User)user).getUsername();
            log.setUsername(username);
        }
        log.setExecutionTime(executionTime);
        log.setUrl(url);
        log.setIp(ip);
        log.setVisitTime(visitTime);


        logger.info(log.toString());
    }

    /**
     * å¼‚å¸¸é€šçŸ¥
     * @param ex
     */
    @AfterThrowing(pointcut = "pointCut()",throwing = "ex")
    public void afterThrowing(Throwable ex){
        Log log = new Log();


        Date visitTime = (Date) request.getAttribute("visitTime"); // è®¿é—®æ—¶é—´
        Date now = new Date();
        int executionTime = (int) (now.getTime() - visitTime.getTime()); // è®¿é—®æ—¶é•¿
        String ip = request.getRemoteAddr(); // è®¿é—®ip
        String url = request.getRequestURI(); // è®¿é—®è·¯å¾„
        // æ‹¿åˆ°Securityä¸­çš„Userå¯¹è±¡
        Object user = SecurityContextHolder.getContext().getAuthentication().getPrincipal();
        if (user instanceof User){
            String username = ((User) user).getUsername();
            log.setUsername(username);
        }
        log.setExecutionTime(executionTime);
        log.setUrl(url);
        log.setIp(ip);
        log.setVisitTime(visitTime);


        // å¼‚å¸¸ä¿¡æ¯
        String exMessage = ex.getMessage();
        log.setExceptionMessage(exMessage);

        logger.info(log.toString());
    }
}
```
ä»¥Controllerä¸ºåˆ‡ç‚¹ï¼Œç¼–å†™å‰ç½®é€šçŸ¥ï¼Œåç½®é€šçŸ¥å’Œå¼‚å¸¸é€šçŸ¥ï¼Œè®°å½•ç”¨æˆ·æ¯ä¸€æ¬¡æ“ä½œçš„å…·ä½“å†…å®¹ã€‚
# äº”. ğŸ¦ å®ç°æ•ˆæœ
![è¾“å…¥å›¾ç‰‡è¯´æ˜](imges/2image.png)
![è¾“å…¥å›¾ç‰‡è¯´æ˜](imges/image.png)
![è¾“å…¥å›¾ç‰‡è¯´æ˜](imges/3image.png)
![è¾“å…¥å›¾ç‰‡è¯´æ˜](imges/5image.png)
![è¾“å…¥å›¾ç‰‡è¯´æ˜](imges/6image.png)
![è¾“å…¥å›¾ç‰‡è¯´æ˜](imges/7image.png)
![è¾“å…¥å›¾ç‰‡è¯´æ˜](imges/8image.png)
![è¾“å…¥å›¾ç‰‡è¯´æ˜](imges/9image.png)

å®Œæ•´æºç è·å–ï¼šCsdn åšä¸»by [ç‹®å­ä¹Ÿç–¯ç‹‚](https://lions.blog.csdn.net/article/details/130452068)
<br/>
VX getï¼š2373489842
